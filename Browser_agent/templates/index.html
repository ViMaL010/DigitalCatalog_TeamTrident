<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Browser Agent</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; padding: 1rem; max-width: 600px; margin: auto; }
    input, button { padding: 10px; font-size: 1rem; width: 100%; margin-top: 10px; }
    .mic-button { width: 100%; padding: 10px; margin-top: 10px; font-size: 1rem; background-color: #eee; cursor: pointer; }
    .mic-button.listening { background-color: #ffcccc; }
    .result { margin-top: 1rem; background: #f0f0f0; padding: 1rem; border-radius: 8px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h2>ğŸ§  Smart Browser Agent</h2>
  <form method="post" action="/run">
    <input type="text" id="user_input" name="user_input" placeholder="Enter your instruction..." required>
    <button type="submit">Run Agent</button>
  </form>

  <button type="button" id="micBtn" class="mic-button">ğŸ¤ Speak</button>

  {% if result %}
    <div class="result">
      <strong>ğŸ“„ Result:</strong><br>{{ result }}
    </div>
  {% endif %}

  <script>
    const micBtn = document.getElementById('micBtn');
    const inputField = document.getElementById('user_input');

    if ('webkitSpeechRecognition' in window) {
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'en-US';
      recognition.continuous = false;
      recognition.interimResults = false;

      micBtn.onclick = () => {
        recognition.start();
        micBtn.textContent = "ğŸ™ï¸ Listening...";
        micBtn.classList.add("listening");
      };

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        inputField.value = transcript;
        micBtn.textContent = "ğŸ¤ Speak";
        micBtn.classList.remove("listening");
      };

      recognition.onerror = (event) => {
        console.error("Speech recognition error", event);
        micBtn.textContent = "ğŸ¤ Speak";
        micBtn.classList.remove("listening");
      };

      recognition.onend = () => {
        micBtn.textContent = "ğŸ¤ Speak";
        micBtn.classList.remove("listening");
      };
    } else {
      micBtn.disabled = true;
      micBtn.textContent = "âŒ Mic not supported";
    }
  </script>
</body>
</html>
